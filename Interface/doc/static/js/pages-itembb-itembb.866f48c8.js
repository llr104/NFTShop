(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-itembb-itembb"],{"0110":function(t,e,o){"use strict";o.r(e);var n=o("665e"),i=o.n(n);for(var a in n)"default"!==a&&function(t){o.d(e,t,(function(){return n[t]}))}(a);e["default"]=i.a},"25a4":function(t,e,o){"use strict";var n=o("baba"),i=o.n(n);i.a},"365e":function(t,e,o){"use strict";o.r(e);var n=o("96b1"),i=o("0110");for(var a in i)"default"!==a&&function(t){o.d(e,t,(function(){return i[t]}))}(a);o("25a4");var s,c=o("f0c5"),r=Object(c["a"])(i["default"],n["b"],n["c"],!1,null,"52c622e2",null,!1,n["a"],s);e["default"]=r.exports},"665e":function(t,e,o){"use strict";var n=o("4ea4");o("99af"),o("a9e3"),Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=o("a735"),a=n(o("64c8")),s=n(o("232a")),c=n(o("cac6")),r=o("f248"),l=o("4e74"),d=o("4f87"),u=o("1c52"),p=d.getETH(),f=d.getProvider(),v={components:{navigation:a.default,transactionItem:s.default,transactionList:c.default},data:function(){return{nftAddress:"",isFound:!1,myAddress:"",isApprove:!1,downSaling:!1,upSaling:!1,buying:!1,approving:!1,openbbing:!1,product:{},txEvents:[],tokenSymbol:"",elem:[]}},onPullDownRefresh:function(){this.queryToken(this.id),uni.stopPullDownRefresh()},onLoad:function(t){var e=this;if(console.log("item onLoad"),this.addressShow=i.addressShow,this.toTokenValue=d.toTokenValue,this.isSameAddress=i.isSameAddress,p.getAccounts((function(t,o){t||0==o.length||(e.myAddress=o[0])})),uni.$on("accountChanged",(function(t){e.myAddress=t})),t.id){var o=Number(t.id);this.id=o,uni.$on("receiptHash",(function(t,n){if(t&&Number(t.tokenId)==o){var i=!0;t.op==u.opType.ApprovingToken?e.approving=!1:t.op==u.opType.UpSalling?e.upSaling=!1:t.op==u.opType.DownSaling?e.downSaling=!1:t.op==u.opType.Buying?e.buying=!1:t.op==u.opType.Opening&&(e.openbbing=!1,i=!1,console.log("receipt:",n),e.openBBResult(n)),i&&e.queryToken(o)}})),this.queryToken(o)}},onUnload:function(){uni.$off("accountChanged"),uni.$off("receiptHash")},methods:{queryToken:function(t){var e=this;console.log("queryToken:",t),d.ready((function(){e.nftAddress=(0,r.nftAddress)(),e.tokenSymbol=d.getTokenSymbol(),e.tokenDecimals=d.getTokenDecimals(),d.queryToken(t,(function(t,o){if(t)e.isFound=!1;else{e.isFound=!0,e.product=o;var n=u.getTransactionPennding(o.id);if(n)for(var i=0;i<n.length;i++){var a=n[i];console.log("hashObj:",a),a.op==u.opType.ApprovingToken?e.approving=!0:a.op==u.opType.UpSalling?e.upSaling=!0:a.op==u.opType.DownSaling?e.downSaling=!0:a.op==u.opType.Buying?e.buying=!0:a.op==u.opType.Opening&&(e.openbbing=!0)}}})),e.qryTX(t),e.qryBBElem(t)}))},qryTX:function(t){var e=this;this.txEvents=[];var o=d.getNFT();p.getBlockNumber((function(n,i){if(!n){i=Number(i);for(var a=(0,r.fromBlock)();a<=i;a+=5e3){var s=Math.min(i,a+5e3);o.getPastEvents("SetOnSale",{filter:{_tokenId:t+""},fromBlock:a,toBlock:s},(function(t,o){t||(e.txEvents=e.txEvents.concat(o),e.$refs.txlist1&&(console.log("txlist1"),e.$refs.txlist1.reload(e.txEvents,4)),e.$refs.txlist2&&e.$refs.txlist2.reload(e.txEvents))}))}}}))},qryBBElem:function(t){var e=this;t=Number(t);var o=d.getNFT(),n=d.getRouter();this.elem=[],o.methods.getAttributesValuebyIndex(t,0).call().then((function(t){t=Number(t),n.methods.getBlinkBoxEleLen(t).call().then((function(o){for(var i=function(o){e.elem.push({name:"",uri:"",des:"",cnt:0}),n.methods.getBlinkBoxEleCfg(t,o).call().then((function(t){e.elem[o].name=t._name,e.elem[o].uri=t._uri,e.elem[o].des=t._des,e.elem[o].cnt=t._cnt}))},a=0;a<Number(o);a++)i(a)}))}))},clickContactAddress:function(){console.log("clickContactAddress"),(0,l.openAddress)((0,r.nftAddress)())},clickOnwerAddress:function(){console.log("clickOnwerAddress:",this.product.ownerAddress),(0,i.copy)(this.product.ownerAddress,(function(t){t||uni.showToast({title:"复制成功"})})),console.log(this.elem)},clickOwnerHome:function(){console.log("clickOwnerHome"),uni.navigateTo({url:"../others/others?address="+this.product.ownerAddress,complete:function(t){console.log(t)}})},clickBuy:function(){var t=this;console.log("clickBuy"),this.$refs.buy_confirm.open("bottom"),d.isApproveToken(this.myAddress,(function(e,o){!e&&o>=t.product.price?t.isApprove=!0:t.isApprove=!1}))},clickMore:function(){var t=this;console.log("clickMore"),this.$refs.ph_popup.open("bottom"),setTimeout((function(){t.$refs.txlist2&&t.$refs.txlist2.reload(t.txEvents)}),100)},clickLink:function(t){(0,l.openTxHash)(t)},clickUpSale:function(){console.log("clickUpSale"),uni.navigateTo({url:"../resell/resell?id="+this.product.id,complete:function(t){console.log(t)}})},clickDownSale:function(){console.log("clickDownSale"),this.$refs.downSale_popup.open("bottom")},downSaleCancle:function(){console.log("downSaleCancle"),this.$refs.downSale_popup.close()},downSaleOK:function(){var t=this;console.log("downSaleOK"),this.$refs.downSale_popup.close();var e=d.getNFT();e.methods.setTokenPrice(this.product.id,0).send({from:this.myAddress}).on("transactionHash",(function(e){t.downSaling=!0,u.setTransactionPennding(t.product.id,e,u.opType.DownSaling)})).on("receipt",(function(e){console.log("receipt:",e),t.downSaling=!1,e.status?(uni.showToast({title:"取消挂售成功"}),t.product.price=0):uni.showToast({title:"取消挂售失败",icon:"error"})})).on("error",(function(e){t.downSaling=!1,uni.showToast({title:"取消挂售失败",icon:"error"})}))},clickApprove:function(){var t=this;console.log("clickApprove"),this.approving=!0;var e=this.product.price;d.approveToken(this.myAddress,e).on("transactionHash",(function(e){u.setTransactionPennding(t.product.id,e,u.opType.ApprovingToken)})).on("receipt",(function(e){t.approving=!1,t.isApprove=!0})).on("error",(function(e){t.approving=!1}))},clickPay:function(){var t=this;this.$refs.buy_confirm.close(),console.log("clickPay",this.product.id,this.myAddress,this.product.price),d.buy(this.product.id,this.myAddress,this.product.price).on("transactionHash",(function(e){t.buying=!0,uni.navigateTo({url:"../buy-result/buy-result?id="+t.product.id+"&hash="+e,complete:function(t){console.log(t)}})})).on("error",(function(e){t.downSaling=!1,uni.showToast({title:"购买失败",icon:"error"})}))},openBB:function(){var t=this;console.log("openBB");var e=d.getRouter();uni.showModal({content:"是否打开盲盒？",success:function(o){t.openbbing=!0,o.confirm&&e.methods.openBlinkBox(t.product.id).send({from:t.myAddress}).on("transactionHash",(function(e){u.setTransactionPennding(t.product.id,e,u.opType.Opening)})).on("receipt",(function(e){console.log("openBB receipt:",e),t.openbbing=!1,t.openBBResult(e)})).on("error",(function(e){t.openbbing=!1}))}})},openBBResult:function(t){if(t.status){if(t.logs&&t.logs.length){var e=f.utils.hexToNumber(t.logs[0].topics[3]);uni.navigateTo({url:"../item/item?id="+e,complete:function(t){console.log(t)}})}}else uni.showToast({title:"开启盲盒失败",icon:"error"})}}};e.default=v},"96b1":function(t,e,o){"use strict";o.d(e,"b",(function(){return i})),o.d(e,"c",(function(){return a})),o.d(e,"a",(function(){return n}));var n={navigation:o("64c8").default,uniTitle:o("8ce4").default,uniPopup:o("4fec").default},i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-uni-view",[n("navigation"),t.isFound?n("v-uni-view",{staticClass:"c"},[n("v-uni-image",{staticClass:"product-image",attrs:{src:t.product.uri,mode:"widthFix"}}),n("uni-title",{staticClass:"product-title",attrs:{title:t.product.name}}),n("v-uni-view",{staticClass:"center-card"},[n("v-uni-view",{staticClass:"one one-margin",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.clickContactAddress.apply(void 0,arguments)}}},[n("v-uni-text",{staticClass:"one-1"},[t._v("合约地址:")]),n("v-uni-text",{staticClass:"one-2 nftAddress"},[t._v(t._s(t.addressShow(t.nftAddress)))])],1),n("v-uni-view",{staticClass:"one one-margin"},[n("v-uni-text",{staticClass:"one-1"},[t._v("链上标志:")]),n("v-uni-text",{staticClass:"one-2"},[t._v(t._s(t.product.id))])],1),n("v-uni-view",{staticClass:"one"},[n("v-uni-text",{staticClass:"one-1"},[t._v("拥有者   :")]),n("v-uni-text",{staticClass:"one-2 oAddress"},[t._v(t._s(t.addressShow(t.product.ownerAddress)))]),n("v-uni-image",{staticClass:"o-copy",attrs:{src:o("6c0d")},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.clickOnwerAddress.apply(void 0,arguments)}}}),n("v-uni-text",{staticClass:"home",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.clickOwnerHome.apply(void 0,arguments)}}},[t._v("个人主页")])],1)],1),n("uni-title",{staticClass:"subTitle",attrs:{type:"h3",title:"作品描述"}}),n("v-uni-text",{staticClass:"product-des"},[t._v(t._s(t.product.describe))]),n("uni-title",{staticClass:"subTitle",attrs:{type:"h3",title:"盲盒包含"}}),n("v-uni-view",{staticClass:"bb-des"},t._l(t.elem,(function(e,o){return n("v-uni-view",{key:o,staticClass:"bb-elem"},[n("v-uni-view",{staticClass:"name"},[t._v(t._s(e.name))]),n("v-uni-view",{staticClass:"elemImg"},[n("v-uni-image",{attrs:{src:e.uri,mode:"aspectFit"}})],1),n("v-uni-view",{staticClass:"cnt"},[t._v("数量"+t._s(e.cnt))]),n("v-uni-view",{staticClass:"des"},[t._v(t._s(e.des))])],1)})),1),n("v-uni-view",{staticClass:"record"},[n("uni-title",{staticClass:"subTitle saleTitle",attrs:{type:"h3",title:"交易记录"}}),n("v-uni-text",{staticClass:"more",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.clickMore.apply(void 0,arguments)}}},[t._v("更多")])],1),n("transaction-list",{ref:"txlist1",attrs:{txEvents:t.txEvents,unitSymbol:t.tokenSymbol},on:{clickLink:function(e){arguments[0]=e=t.$handleEvent(e),t.clickLink.apply(void 0,arguments)}}}),n("v-uni-view",{staticClass:"bottom"},[n("v-uni-view",{staticClass:"bottom-fixed"},[t.product.price?n("v-uni-view",{staticClass:"price"},[t._v(t._s(t.product.showPrice)+" "+t._s(t.tokenSymbol))]):t._e(),t.downSaling?n("v-uni-button",{staticClass:"downSaling",attrs:{type:"default",loading:"true"}},[t._v("下架中...")]):t.upSaling?n("v-uni-button",{staticClass:"upSaling",attrs:{type:"default",loading:"true"}},[t._v("上架中...")]):t.buying?n("v-uni-button",{staticClass:"buying",attrs:{type:"default",loading:"true"}},[t._v("购买中...")]):t.openbbing?n("v-uni-button",{staticClass:"openbbing",attrs:{type:"default",loading:"true"}},[t._v("开启中...")]):!t.product.price&&t.isSameAddress(t.myAddress,t.product.ownerAddress)?n("v-uni-button",{staticClass:"upSale",attrs:{type:"default"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.clickUpSale.apply(void 0,arguments)}}},[t._v("立即挂售")]):t.product.price&&t.isSameAddress(t.myAddress,t.product.ownerAddress)?n("v-uni-button",{staticClass:"downSale",attrs:{type:"default"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.clickDownSale.apply(void 0,arguments)}}},[t._v("取消挂售")]):t.product.price?n("v-uni-button",{staticClass:"buy",attrs:{type:"default"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.clickBuy.apply(void 0,arguments)}}},[t._v("立即购买")]):t.product.price?t._e():n("v-uni-button",{staticClass:"SaleOut",attrs:{type:"default"}},[t._v("已售罄")]),0==t.openbbing&&0==t.product.nftType&&!t.product.price&&t.isSameAddress(t.myAddress,t.product.ownerAddress)?n("v-uni-button",{staticClass:"open",attrs:{type:"default"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.openBB.apply(void 0,arguments)}}},[t._v("开盲盒")]):t._e()],1),n("v-uni-view",{staticClass:"space"})],1),n("uni-popup",{ref:"downSale_popup",staticClass:"downSale_popup",attrs:{type:"top"}},[n("v-uni-view",{staticClass:"c"},[n("uni-title",{staticClass:"t",attrs:{title:"您确定取消挂售吗？",type:"h1"}}),n("v-uni-button",{staticClass:"downSaleBtnLeft",attrs:{type:"default"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.downSaleCancle.apply(void 0,arguments)}}},[t._v("取消")]),n("v-uni-button",{staticClass:"downSaleBtnRight",attrs:{type:"default"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.downSaleOK.apply(void 0,arguments)}}},[t._v("确定")])],1)],1),n("uni-popup",{ref:"buy_confirm",staticClass:"buy_confirm"},[n("v-uni-view",{staticClass:"c"},[n("uni-title",{staticClass:"t",attrs:{title:"订单信息",type:"h2"}}),n("v-uni-view",{staticClass:"uri"},[n("v-uni-image",{staticClass:"uri",attrs:{src:t.product.uri,mode:""}})],1),n("v-uni-view",{staticClass:"l"},[n("v-uni-view",{staticClass:"l1"},[n("v-uni-text",[t._v(t._s(t.product.name))])],1),n("v-uni-view",{staticClass:"l1"},[n("v-uni-text",[t._v("链上标识:"+t._s(t.product.id))])],1),n("v-uni-view",{staticClass:"l2"},[n("v-uni-text",[t._v("价格:"+t._s(t.product.showPrice)+" "+t._s(t.tokenSymbol))])],1)],1),t.approving?n("v-uni-button",{staticClass:"approving2",attrs:{type:"default",loading:"true"}},[t._v("授权中...")]):0==t.isApprove&&0==t.approving?n("v-uni-button",{staticClass:"approve",attrs:{type:"default"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.clickApprove.apply(void 0,arguments)}}},[t._v("授权")]):n("v-uni-button",{staticClass:"pay",attrs:{type:"default"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.clickPay.apply(void 0,arguments)}}},[t._v("支付")])],1)],1)],1):t._e(),n("uni-popup",{ref:"ph_popup",staticClass:"ph",attrs:{type:"bottom"}},[n("v-uni-view",{staticClass:"t"},[n("uni-title",{staticClass:"tt",attrs:{title:"交易记录",type:"h2"}})],1),n("v-uni-scroll-view",{staticClass:"sh",attrs:{"scroll-y":"true"}},[n("transaction-list",{ref:"txlist2",attrs:{txEvents:t.txEvents,unitSymbol:t.tokenSymbol},on:{clickLink:function(e){arguments[0]=e=t.$handleEvent(e),t.clickLink.apply(void 0,arguments)}}})],1)],1)],1)},a=[]},afbc:function(t,e,o){var n=o("24fb"),i=o("1de5"),a=o("303a");e=n(!1);var s=i(a);e.push([t.i,'@charset "UTF-8";\n/* 水平间距 */\n/* 水平间距 */.c[data-v-52c622e2]{padding:%?20?% %?20?% 0 %?20?%}.product-image[data-v-52c622e2]{width:100%}.product-title[data-v-52c622e2]{margin-left:%?20?%}.center-card[data-v-52c622e2]{border-radius:%?40?%;background-color:#d9dcde;margin:%?30?%;padding:%?40?%}.center-card .one-margin[data-v-52c622e2]{margin-bottom:%?40?%}.center-card .one[data-v-52c622e2]{position:relative}.center-card .one .one-1[data-v-52c622e2]{color:#8c9fad}.center-card .one .one-2[data-v-52c622e2]{margin-left:%?10?%;color:#000}.center-card .one .nftAddress[data-v-52c622e2]::after{display:inline-block;position:absolute;content:"";width:%?30?%;height:%?30?%;right:%?20?%;background:url('+s+') 50% no-repeat}.center-card .one .o-copy[data-v-52c622e2]{vertical-align:middle;width:%?40?%;height:%?40?%}.center-card .one .home[data-v-52c622e2]{display:inline-block;float:right;color:#8c9fad;font-size:%?25?%;line-height:%?30?%;margin-right:%?60?%}.center-card .one .home[data-v-52c622e2]::after{display:inline-block;position:absolute;content:"";width:%?30?%;height:%?30?%;right:%?20?%;background:url('+s+') 50% no-repeat}.subTitle[data-v-52c622e2]{margin-left:%?10?%;margin-top:%?20?%}.product-des[data-v-52c622e2]{margin:%?0?% %?30?% %?20?% %?30?%;word-break:break-all;display:-webkit-box;overflow:hidden;text-overflow:ellipsis;color:#5e697a;font-size:%?28?%;line-height:1.5}.bb-des[data-v-52c622e2]{border-radius:%?20?%;text-align:center;background-color:#fff}.bb-des .bb-elem[data-v-52c622e2]{margin:%?20?% auto}.bb-des .bb-elem .name[data-v-52c622e2]{font-weight:700;font-size:%?30?%;line-height:%?50?%}.bb-des .bb-elem .cnt[data-v-52c622e2]{font-weight:700;font-size:%?30?%;line-height:%?50?%;color:#ff557f}.bb-des .bb-elem .des[data-v-52c622e2]{text-align:left;margin:0 %?20?%}.record[data-v-52c622e2]{vertical-align:middle}.record .saleTitle[data-v-52c622e2]{display:inline-block}.record .more[data-v-52c622e2]{display:inline-block;position:relative;height:100%;float:right;right:%?50?%;top:%?50?%;font-size:%?30?%;color:#5e697a}.record .more[data-v-52c622e2]::after{display:inline-block;position:absolute;content:"";width:%?30?%;height:%?30?%;margin-top:%?10?%;right:%?-30?%;background:url('+s+") 50% no-repeat}.t[data-v-52c622e2]{height:%?100?%;width:100%;background-color:#fff}.t .tt[data-v-52c622e2]{margin-left:%?30?%}.bottom[data-v-52c622e2]{width:100%;height:%?100?%;background-color:#fff}.bottom .space[data-v-52c622e2]{width:100%;height:%?200?%}.bottom .bottom-fixed[data-v-52c622e2]{position:fixed;left:0;bottom:0;width:100%;z-index:1;line-height:%?100?%;background-color:#fff}.bottom .bottom-fixed .price[data-v-52c622e2]{float:left;display:inline-block;margin-left:%?50?%;font-weight:bolder;font-size:%?40?%;color:#ff56a7}.bottom .bottom-fixed .upSale[data-v-52c622e2],\n.bottom .bottom-fixed .upSaling[data-v-52c622e2],\n.bottom .bottom-fixed .open[data-v-52c622e2],\n.bottom .bottom-fixed .openbbing[data-v-52c622e2]{width:80%;height:%?80?%;background-color:#000;border-radius:%?30?%;text-align:center;line-height:%?80?%;font-weight:700;color:#fff;margin:%?10?% auto}.bottom .bottom-fixed .downSale[data-v-52c622e2],\n.bottom .bottom-fixed .downSaling[data-v-52c622e2]{float:right;display:inline-block;vertical-align:middle;width:%?250?%;height:%?80?%;background-color:#000;border-radius:%?30?%;text-align:center;line-height:%?80?%;font-weight:700;color:#fff;margin:%?10?% %?20?%}.bottom .bottom-fixed .buy[data-v-52c622e2],\n.bottom .bottom-fixed .buying[data-v-52c622e2]{float:right;display:inline-block;vertical-align:middle;width:%?250?%;height:%?80?%;background-color:#000;border-radius:%?30?%;text-align:center;line-height:%?80?%;font-weight:700;color:#fff;margin:%?10?% %?20?%}.bottom .bottom-fixed .SaleOut[data-v-52c622e2]{float:right;display:inline-block;vertical-align:middle;width:%?250?%;height:%?80?%;background-color:#e7e7e7;border-radius:%?30?%;text-align:center;line-height:%?80?%;font-weight:700;color:#000;margin:%?10?% %?20?%}.ph[data-v-52c622e2]{height:%?800?%;z-index:2;touch-action:none}.sh[data-v-52c622e2]{width:100%;height:%?700?%;background-color:#fff}.downSale_popup .c[data-v-52c622e2]{width:100%;height:%?280?%;background-color:#fff}.downSale_popup .c .t[data-v-52c622e2]{margin-left:%?50?%}.downSale_popup .c .downSaleBtnLeft[data-v-52c622e2]{float:left;margin-left:%?50?%;width:35%;border-radius:%?20?%}.downSale_popup .c .downSaleBtnRight[data-v-52c622e2]{float:right;margin-right:%?50?%;width:35%;background-color:#000;color:#fff;border-radius:%?20?%}.buy_confirm .c[data-v-52c622e2]{width:100%;height:%?300?%;background-color:#fff}.buy_confirm .c .t[data-v-52c622e2]{margin-left:%?50?%}.buy_confirm .c .uri[data-v-52c622e2]{float:left;width:%?140?%;height:%?140?%;border-radius:%?20?%;margin-left:%?20?%;display:inline-block}.buy_confirm .c .l[data-v-52c622e2]{float:left;margin-top:%?10?%;margin-left:%?30?%}.buy_confirm .c .l1[data-v-52c622e2]{color:#8c9fad;font-size:%?28?%;line-height:1.5}.buy_confirm .c .l2[data-v-52c622e2]{color:red;font-size:%?28?%;line-height:1.5}.buy_confirm .c .pay[data-v-52c622e2]{width:%?200?%;background-color:#000;color:#fff;font-weight:700;margin-top:%?10?%}.buy_confirm .c .approve[data-v-52c622e2]{width:%?200?%;background-color:#000;color:#fff;font-weight:700;margin-top:%?10?%}.buy_confirm .c .approving2[data-v-52c622e2]{width:%?250?%;background-color:#000;color:#fff;font-weight:700;margin-top:%?10?%}",""]),t.exports=e},baba:function(t,e,o){var n=o("afbc");"string"===typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);var i=o("4f06").default;i("7e8f46a0",n,!0,{sourceMap:!1,shadowMode:!1})}}]);